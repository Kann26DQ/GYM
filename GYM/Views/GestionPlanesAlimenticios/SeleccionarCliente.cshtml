@model IEnumerable<GYM.Models.Usuario>
@{
    ViewData["Title"] = "Seleccionar Cliente";
    var empleadoNombre = ViewData["EmpleadoNombre"] as string;
    var totalClientes = (int?)ViewData["TotalClientes"] ?? 0;
    var totalEnGrupo = (int?)ViewData["TotalEnGrupo"] ?? 0;
    // ✅ NUEVO: Recibir información de clientes con/sin plan alimenticio
    var clientesSinPlanAlimenticio = ViewData["ClientesSinPlanAlimenticio"] as List<int> ?? new List<int>();
}

<style>
    body {
        background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 50%, #1a1a1a 100%);
        min-height: 100vh;
        padding-bottom: 120px;
    }

    .cliente-card {
        background: rgba(45, 45, 45, 0.95);
        border: 2px solid rgba(76, 255, 76, 0.4);
        border-radius: 15px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        transition: all 0.3s;
    }

        .cliente-card:hover {
            border-color: #4cff4c;
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(76, 255, 76, 0.4);
        }

        /* ✅ CLIENTE BLOQUEADO (Sin plan alimenticio) */
        .cliente-card.bloqueado {
            background: rgba(60, 60, 60, 0.5);
            border: 2px solid rgba(220, 53, 69, 0.4);
            opacity: 0.7;
        }

            .cliente-card.bloqueado:hover {
                border-color: #dc3545;
                transform: none;
                box-shadow: none;
            }

    .text-green {
        color: #4cff4c !important;
        font-weight: 600;
        text-shadow: 0 0 5px rgba(76, 255, 76, 0.3);
    }

    .text-white-custom {
        color: #ffffff !important;
        font-weight: 500;
    }

    .btn-seleccionar {
        background: linear-gradient(135deg, #4cff4c 0%, #20c997 100%);
        color: #1a1a1a !important;
        border: none;
        padding: 0.7rem 1.8rem;
        border-radius: 12px;
        font-weight: bold;
        text-decoration: none;
        transition: all 0.3s;
        display: inline-block;
        box-shadow: 0 3px 12px rgba(76, 255, 76, 0.4);
    }

        .btn-seleccionar:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 18px rgba(76, 255, 76, 0.6);
            color: #000000 !important;
        }

    /* ✅ BOTÓN BLOQUEADO */
    .btn-bloqueado {
        background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        color: #ffffff !important;
        border: none;
        padding: 0.7rem 1.8rem;
        border-radius: 12px;
        font-weight: bold;
        cursor: not-allowed;
        opacity: 0.6;
    }

        .btn-bloqueado:hover {
            transform: none;
            box-shadow: none;
        }

    /* ✅ MENSAJE DE BLOQUEO */
    .mensaje-sin-plan {
        background: rgba(220, 53, 69, 0.15);
        border: 1px solid rgba(220, 53, 69, 0.4);
        border-radius: 8px;
        padding: 0.5rem 0.8rem;
        margin-top: 0.5rem;
        font-size: 0.85rem;
        color: #ff6b6b !important;
    }

        .mensaje-sin-plan i {
            color: #ff6b6b;
        }

    .info-banner {
        background: rgba(32, 201, 151, 0.15);
        border: 2px solid #20c997;
        border-radius: 15px;
        padding: 1.5rem;
    }

    .alert {
        border-width: 2px;
    }

    .alert-warning {
        background: rgba(255, 193, 7, 0.15) !important;
        border-color: #ffc107 !important;
        color: #ffffff !important;
    }

    h2, h3, h4, h5 {
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    }

    small, p {
        color: #ffffff !important;
    }

    strong {
        color: #4cff4c !important;
    }
</style>

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="text-green mb-1">
                <i class="fa fa-users me-2"></i>Seleccionar Cliente
            </h2>
            <p class="text-white-custom mb-0">
                <i class="fa fa-user-tie me-1"></i>@empleadoNombre
            </p>
        </div>
        <a asp-action="Index" class="btn btn-outline-success">
            <i class="fa fa-arrow-left me-2"></i>Volver
        </a>
    </div>

    @if (TempData["Warning"] != null)
    {
        <div class="alert alert-warning alert-dismissible fade show">
            <i class="fa fa-exclamation-triangle me-2"></i><span class="text-white-custom">@TempData["Warning"]</span>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert"></button>
        </div>
    }

    <!-- Información -->
    <div class="info-banner mb-4">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h5 class="text-green mb-2">
                    <i class="fa fa-info-circle me-2"></i>Clientes de Tu Grupo
                </h5>
                <p class="text-white-custom mb-0 small">
                    Se muestran todos los clientes de <strong class="text-green">tu grupo</strong>.
                    Solo puedes crear planes para quienes tienen membresía con
                    <strong class="text-green">Plan Alimenticio activo</strong>.
                </p>
            </div>
            <div class="col-md-4 text-end">
                <div class="text-white-custom">
                    <h3 class="text-green mb-0">@totalClientes</h3>
                    <small class="text-white-custom">con plan alimenticio</small>
                    <br />
                    <small class="text-white-custom">de @totalEnGrupo en tu grupo</small>
                </div>
            </div>
        </div>
    </div>

    @if (Model != null && Model.Any())
    {
        <div class="row">
            @foreach (var cliente in Model)
            {
                var estaBloqueado = clientesSinPlanAlimenticio.Contains(cliente.UsuarioId);

                <div class="col-md-6 col-lg-4">
                    <div class="cliente-card @(estaBloqueado ? "bloqueado" : "")">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div class="flex-grow-1">
                                <h5 class="@(estaBloqueado ? "text-white-custom" : "text-green") mb-1">
                                    <i class="fa fa-user me-2"></i>@cliente.Nombre
                                </h5>
                                <p class="text-white-custom small mb-0">
                                    <i class="fa fa-envelope me-1"></i>@cliente.Email
                                </p>
                            </div>
                            @if (estaBloqueado)
                            {
                                <span class="badge bg-danger">
                                    <i class="fa fa-ban me-1"></i>Bloqueado
                                </span>
                            }
                            else
                            {
                                <span class="badge bg-success">
                                    <i class="fa fa-check-circle me-1"></i>Disponible
                                </span>
                            }
                        </div>

                        @if (estaBloqueado)
                        {
                            <!-- ✅ CLIENTE BLOQUEADO -->
                            <button class="btn-bloqueado w-100 text-center" disabled>
                                <i class="fa fa-lock me-2"></i>No Disponible
                            </button>
                            <div class="mensaje-sin-plan">
                                <i class="fa fa-exclamation-circle me-1"></i>
                                <strong>Sin plan alimenticio en membresía</strong><br />
                                <small style="color: #ffffff !important;">Este cliente debe actualizar su membresía para incluir plan alimenticio.</small>
                            </div>
                        }
                        else
                        {
                            <!-- ✅ CLIENTE DISPONIBLE -->
                            <a asp-action="Crear" asp-route-clienteId="@cliente.UsuarioId" class="btn-seleccionar w-100 text-center d-block">
                                <i class="fa fa-plus-circle me-2"></i>Crear Plan Alimenticio
                            </a>
                        }
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="text-center py-5">
            <i class="fa fa-exclamation-triangle text-warning mb-4" style="font-size: 5rem;"></i>
            <h4 class="text-white-custom mb-3">No hay clientes en tu grupo</h4>
            <p class="text-white-custom mb-4">
                Necesitas evaluar clientes primero para formar tu grupo.
            </p>
            <div class="alert alert-info d-inline-block" style="background: rgba(32, 201, 151, 0.15); border: 2px solid #20c997; max-width: 500px;">
                <ul class="text-start text-white-custom mb-0">
                    <li class="mb-2">
                        <i class="fa fa-check-circle text-green me-2"></i>
                        Ve a <strong class="text-green">Mis Grupos</strong> para evaluar clientes
                    </li>
                    <li class="mb-0">
                        <i class="fa fa-check-circle text-green me-2"></i>
                        Luego podrás crear planes alimenticios para ellos
                    </li>
                </ul>
            </div>
            <div class="mt-4">
                <a asp-controller="GestionRutinas" asp-action="MisGrupos" class="btn btn-outline-info me-2">
                    <i class="fa fa-users me-2"></i>Ver Mis Grupos
                </a>
                <a asp-action="Index" class="btn btn-outline-success">
                    <i class="fa fa-arrow-left me-2"></i>Volver
                </a>
            </div>
        </div>
    }
</div>

<div style="height: 150px;"></div>