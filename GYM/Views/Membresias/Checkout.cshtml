@using GYM.Models
@{
    ViewData["Title"] = "Pago Seguro";
    Layout = null;
    var plan = ViewData["Plan"] as MembresiaPlan;
    var usuario = ViewData["Usuario"] as Usuario;
}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - GYM</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <style>
        body {
            background: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)),
                        url("https://images.unsplash.com/photo-1571019613914-85f342c9b30e") no-repeat center center fixed;
            background-size: cover;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            padding: 40px 0;
        }

        .card-custom {
            backdrop-filter: blur(10px);
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 1.5rem;
            padding: 2rem;
            box-shadow: 0 8px 20px rgba(0,0,0,0.5);
            color: white;
            max-width: 600px;
            margin: 0 auto;
        }

        .card-header-custom {
            font-size: 1.8rem;
            font-weight: bold;
            color: #ffc107;
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .form-label {
            font-weight: 600;
            color: #f8f9fa;
        }

        .form-control {
            border-radius: 0.75rem;
            padding: 0.7rem;
            background-color: rgba(255, 255, 255, 0.9);
        }

        .form-control:focus {
            border-color: #ffc107;
            box-shadow: 0 0 0 0.2rem rgba(255, 193, 7, 0.25);
        }

        .btn-warning {
            border-radius: 0.75rem;
            font-weight: bold;
            transition: 0.3s;
            color: #000;
            padding: 0.8rem;
        }

        .btn-warning:hover {
            background-color: #ffcd39;
            transform: scale(1.02);
        }

        .btn-secondary {
            border-radius: 0.75rem;
            padding: 0.8rem;
        }

        .resumen-pedido {
            backdrop-filter: blur(15px);
            background-color: rgba(255, 255, 255, 0.1);
            border: 2px solid #ffc107;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .resumen-pedido h5 {
            color: #ffc107;
            margin-bottom: 1rem;
        }

        .resumen-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            color: #f8f9fa;
        }

        .total {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ffc107;
            border-top: 2px solid #ffc107;
            padding-top: 1rem;
            margin-top: 1rem;
        }

        .security-badge {
            text-align: center;
            color: #6c757d;
            font-size: 0.85rem;
            margin-top: 1rem;
        }

        .security-badge i {
            color: #28a745;
        }

        .card-logos {
            text-align: center;
            margin-top: 1rem;
        }

        .card-logos img {
            height: 30px;
            margin: 0 5px;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card-custom">
            <div class="card-header-custom">
                <i class="bi bi-credit-card me-2"></i>Pago Seguro
            </div>

            @if (TempData["Error"] != null)
            {
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    <i class="bi bi-exclamation-circle me-2"></i>@TempData["Error"]
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            }

            <!-- Resumen del pedido -->
            <div class="resumen-pedido">
                <h5><i class="bi bi-receipt me-2"></i>Resumen del Pedido</h5>
                <div class="resumen-item">
                    <span>Plan:</span>
                    <strong>@plan.Nombre</strong>
                </div>
                <div class="resumen-item">
                    <span>Duración:</span>
                    <span>@plan.DuracionDias días</span>
                </div>
                <div class="resumen-item">
                    <span>Cliente:</span>
                    <span>@usuario.Nombre</span>
                </div>
                <div class="resumen-item total">
                    <span>Total a Pagar:</span>
                    <span>S/ @plan.Precio.ToString("0.00")</span>
                </div>
            </div>

            <!-- Formulario de pago -->
            <form asp-action="ProcesarPago" method="post" id="paymentForm">
                @Html.AntiForgeryToken()
                <input type="hidden" name="planId" value="@plan.MembresiaPlanId" />

                <div class="mb-3">
                    <label for="numeroTarjeta" class="form-label">
                        <i class="bi bi-credit-card me-1"></i>Número de Tarjeta
                    </label>
                    <input type="text" class="form-control" id="numeroTarjeta" name="numeroTarjeta" 
                           placeholder="1234 5678 9012 3456" maxlength="19" required 
                           pattern="\d{4}\s?\d{4}\s?\d{4}\s?\d{4}">
                    <small class="text-muted">Ingrese los 16 dígitos de su tarjeta</small>
                </div>

                <div class="mb-3">
                    <label for="nombreTitular" class="form-label">
                        <i class="bi bi-person me-1"></i>Nombre del Titular
                    </label>
                    <input type="text" class="form-control" id="nombreTitular" name="nombreTitular" 
                           placeholder="Como aparece en la tarjeta" required>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="fechaExpiracion" class="form-label">
                            <i class="bi bi-calendar me-1"></i>Fecha de Expiración
                        </label>
                        <input type="text" class="form-control" id="fechaExpiracion" name="fechaExpiracion" 
                               placeholder="MM/AA" maxlength="5" required pattern="\d{2}/\d{2}">
                    </div>

                    <div class="col-md-6 mb-3">
                        <label for="cvv" class="form-label">
                            <i class="bi bi-shield-lock me-1"></i>CVV
                        </label>
                        <input type="text" class="form-control" id="cvv" name="cvv" 
                               placeholder="123" maxlength="3" required pattern="\d{3}">
                    </div>
                </div>

                <div class="card-logos mb-3">
                    <span class="text-muted">Aceptamos:</span><br>
                    <i class="bi bi-credit-card-2-front" style="font-size: 2rem; color: #ffc107; margin: 0 10px;"></i>
                    <i class="bi bi-credit-card" style="font-size: 2rem; color: #ffc107; margin: 0 10px;"></i>
                </div>

                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-warning btn-lg">
                        <i class="bi bi-lock-fill me-2"></i>Pagar S/ @plan.Precio.ToString("0.00")
                    </button>
                    <a asp-action="Store" class="btn btn-secondary">
                        <i class="bi bi-arrow-left me-2"></i>Cancelar
                    </a>
                </div>

                <div class="security-badge">
                    <i class="bi bi-shield-check"></i> Transacción 100% segura y encriptada
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Formatear número de tarjeta
        document.getElementById('numeroTarjeta').addEventListener('input', function (e) {
            let value = e.target.value.replace(/\s/g, '');
            let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
            e.target.value = formattedValue;
        });

        // Formatear fecha de expiración
        document.getElementById('fechaExpiracion').addEventListener('input', function (e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length >= 2) {
                value = value.slice(0, 2) + '/' + value.slice(2, 4);
            }
            e.target.value = value;
        });

        // Solo números en CVV
        document.getElementById('cvv').addEventListener('input', function (e) {
            e.target.value = e.target.value.replace(/\D/g, '');
        });
    </script>
</body>
</html>