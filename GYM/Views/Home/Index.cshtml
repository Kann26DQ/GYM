@using GYM.Models
@{
    ViewData["Title"] = "Inicio";
    var tieneMembresia = ViewData["TieneMembresia"] as bool?;
    var membresias = ViewData["Membresias"] as List<MembresiaPlan>;
    var nombreUsuario = User.Identity?.Name ?? "Usuario";
    var tipoMembresia = ViewData["TipoMembresia"] as string ?? "mensual";

    // Variables para el mensaje de ascenso
    var mostrarMensajeAscenso = ViewData["MostrarMensajeAscenso"] as bool? ?? false;
    var nombreUsuarioAscendido = ViewData["NombreUsuario"] as string ?? nombreUsuario;

    // ✅ NUEVO: Información del Gymbro asignado
    var tieneGymbro = ViewData["TieneGymbro"] as bool? ?? false;
    var nombreGymbro = ViewData["NombreGymbro"] as string;
    var emailGymbro = ViewData["EmailGymbro"] as string;
}

<style>
    body {
        background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 50%, #1a1a1a 100%);
        min-height: 100vh;
    }

    .hero-section {
        background: linear-gradient(135deg, rgba(255, 193, 7, 0.1) 0%, rgba(255, 237, 74, 0.05) 100%);
        border-radius: 30px;
        padding: 3rem;
        margin-bottom: 2rem;
        position: relative;
        overflow: hidden;
    }

        .hero-section::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 193, 7, 0.1) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
            z-index: 0;
        }

        .hero-section > * {
            position: relative;
            z-index: 1;
        }

    /* ✅ Tarjeta del Gymbro */
    .gymbro-card {
        background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
        border: 2px solid #ffc107;
        border-radius: 20px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        position: relative;
        overflow: hidden;
        transition: all 0.3s;
    }

        .gymbro-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 193, 7, 0.4);
        }

        .gymbro-card::before {
            content: '💪';
            position: absolute;
            top: -10px;
            right: 20px;
            font-size: 6rem;
            opacity: 0.1;
        }

        .gymbro-card > * {
            position: relative;
            z-index: 1;
        }

    .text-yellow {
        color: #ffc107;
        text-shadow: 0 0 10px rgba(255, 193, 7, 0.5);
    }

    .text-white-custom {
        color: #f8f9fa;
    }

    .btn-yellow {
        background: linear-gradient(135deg, #ffc107 0%, #ffed4e 100%);
        color: #1a1a1a !important;
        border: none;
        padding: 0.8rem 2rem;
        border-radius: 20px;
        font-weight: bold;
        transition: all 0.3s;
        box-shadow: 0 4px 15px rgba(255, 193, 7, 0.4);
        text-decoration: none;
        display: inline-block;
    }

        .btn-yellow:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 193, 7, 0.6);
            color: #000 !important;
            text-decoration: none;
        }

    .feature-card {
        background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
        border: 2px solid rgba(255, 193, 7, 0.3);
        border-radius: 20px;
        padding: 2rem;
        transition: all 0.3s;
        height: 100%;
        position: relative;
        overflow: hidden;
    }

        .feature-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 193, 7, 0.05) 0%, transparent 70%);
            z-index: 0;
        }

        .feature-card > * {
            position: relative;
            z-index: 1;
        }

        .feature-card:hover {
            border-color: #ffc107;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 193, 7, 0.3);
        }

    .icon-circle {
        width: 80px;
        height: 80px;
        background: linear-gradient(135deg, #ffc107 0%, #ffed4e 100%);
        border-radius: 50%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        color: #1a1a1a;
        box-shadow: 0 0 30px rgba(255, 193, 7, 0.5);
        animation: float 3s ease-in-out infinite;
        margin-bottom: 1rem;
    }

    @@keyframes float {
        0%, 100% {
            transform: translateY(0px);
        }

        50% {
            transform: translateY(-10px);
        }
    }

    @@keyframes pulse {
        0%, 100% {
            transform: scale(1);
            opacity: 0.5;
        }

        50% {
            transform: scale(1.1);
            opacity: 0.8;
        }
    }

    .membership-card {
        background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
        border: 2px solid rgba(255, 193, 7, 0.3);
        border-radius: 20px;
        transition: all 0.3s;
        overflow: hidden;
    }

        .membership-card:hover {
            border-color: #ffc107;
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(255, 193, 7, 0.4);
        }

    .content-wrapper {
        padding-bottom: 150px;
    }

    /* ✅ Estilos para alertas */
    .alert-custom-success {
        background: linear-gradient(135deg, rgba(40, 167, 69, 0.2) 0%, rgba(34, 139, 61, 0.2) 100%);
        border: 2px solid #28a745;
        color: #fff;
        border-radius: 15px;
    }

    .alert-custom-warning {
        background: rgba(255, 193, 7, 0.2);
        border: 2px solid #ffc107;
        border-radius: 15px;
        color: #fff;
    }

    /* ✅ Estilos del modal de ascenso */
    .confetti-container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        pointer-events: none;
        z-index: 0;
    }

    .confetti {
        position: absolute;
        width: 10px;
        height: 10px;
        background: #ffc107;
        animation: confetti-fall 3s ease-in-out infinite;
    }

        .confetti:nth-child(1) {
            left: 10%;
            animation-delay: 0s;
            background: #ff6b6b;
        }

        .confetti:nth-child(2) {
            left: 30%;
            animation-delay: 0.5s;
            background: #4ade80;
        }

        .confetti:nth-child(3) {
            left: 50%;
            animation-delay: 1s;
            background: #ffc107;
        }

        .confetti:nth-child(4) {
            left: 70%;
            animation-delay: 1.5s;
            background: #667eea;
        }

        .confetti:nth-child(5) {
            left: 85%;
            animation-delay: 2s;
            background: #ff6b6b;
        }

        .confetti:nth-child(6) {
            left: 95%;
            animation-delay: 2.5s;
            background: #4ade80;
        }

    @@keyframes confetti-fall {
        0% {
            transform: translateY(-100px) rotate(0deg);
            opacity: 1;
        }

        100% {
            transform: translateY(600px) rotate(360deg);
            opacity: 0;
        }
    }

    #modalAscenso .modal-content > * {
        position: relative;
        z-index: 1;
    }
</style>

<!-- 👇 Modal de felicitación por ascenso -->
@if (mostrarMensajeAscenso)
{
    <div class="modal fade show" id="modalAscenso" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false" style="display: block; background: rgba(0,0,0,0.5);">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 20px;">
                <div class="modal-body text-center p-5 text-white position-relative">
                    <!-- Animación de confetti con CSS -->
                    <div class="confetti-container">
                        <div class="confetti"></div>
                        <div class="confetti"></div>
                        <div class="confetti"></div>
                        <div class="confetti"></div>
                        <div class="confetti"></div>
                        <div class="confetti"></div>
                    </div>

                    <div class="mb-4">
                        <i class="fa fa-trophy fa-5x mb-3" style="color: #ffc107; text-shadow: 0 0 20px rgba(255, 193, 7, 0.5);"></i>
                    </div>

                    <h1 class="display-4 fw-bold mb-3">¡Felicidades, @nombreUsuarioAscendido!</h1>

                    <h3 class="mb-4">🎉 Has sido ascendido a Gymbro 🎉</h3>

                    <div class="card mx-auto" style="max-width: 600px; background: rgba(255, 255, 255, 0.1); border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 15px;">
                        <div class="card-body p-4">
                            <p class="lead mb-3">
                                Por tu <strong>fidelidad</strong> y <strong>dedicación</strong> en nuestro gimnasio,
                                has demostrado ser un verdadero ejemplo a seguir.
                            </p>
                            <p class="mb-3">
                                Ahora tendrás la oportunidad de <strong>ayudar a otros clientes</strong> en su progreso
                                y compartir tu experiencia para motivar a la comunidad.
                            </p>
                            <div class="mt-4 pt-3 border-top border-white border-opacity-25">
                                <h5 class="mb-3">
                                    <i class="fa fa-star me-2" style="color: #ffc107;"></i>
                                    Tus nuevas responsabilidades:
                                </h5>
                                <ul class="list-unstyled text-start">
                                    <li class="mb-2">
                                        <i class="fa fa-check-circle me-2" style="color: #4ade80;"></i>
                                        Crear rutinas personalizadas para los clientes
                                    </li>
                                    <li class="mb-2">
                                        <i class="fa fa-check-circle me-2" style="color: #4ade80;"></i>
                                        Diseñar planes alimenticios adaptados a cada objetivo
                                    </li>
                                    <li class="mb-2">
                                        <i class="fa fa-check-circle me-2" style="color: #4ade80;"></i>
                                        Motivar y guiar a la comunidad del gimnasio
                                    </li>
                                    <li class="mb-2">
                                        <i class="fa fa-check-circle me-2" style="color: #4ade80;"></i>
                                        Ser un referente de dedicación y compromiso
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="mt-4">
                        <p class="fs-5 mb-4">
                            <i class="fa fa-heart me-2" style="color: #ff6b6b;"></i>
                            ¡Gracias por ser parte de nuestra familia GYM PRO!
                        </p>
                        <button type="button" class="btn btn-light btn-lg px-5 py-3" onclick="cerrarModalAscenso()" style="border-radius: 50px; font-weight: bold; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);">
                            <i class="fa fa-rocket me-2"></i>¡Comenzar mi nueva aventura!
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 👇 Script inline para garantizar ejecución inmediata
        function cerrarModalAscenso() {
            var modal = document.getElementById('modalAscenso');
            if (modal) {
                modal.classList.remove('show');
                modal.style.display = 'none';
                document.body.classList.remove('modal-open');
                var backdrop = document.querySelector('.modal-backdrop');
                if (backdrop) backdrop.remove();
            }
        }

        // Agregar clase modal-open al body para efecto de backdrop
        document.body.classList.add('modal-open');
    </script>
}

<div class="container mt-4 content-wrapper">
    <!-- Hero Section -->
    <div class="hero-section">
        <div class="text-center">
            <div class="icon-circle mx-auto">
                <i class="fa fa-home"></i>
            </div>
            <h1 class="display-4 text-yellow mb-3">¡Bienvenido, @nombreUsuario! 👋</h1>
            <p class="lead text-white-custom">Tu camino hacia una vida más saludable comienza aquí</p>
        </div>
    </div>

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-custom-success alert-dismissible fade show mb-4">
            <i class="fa fa-check-circle me-2"></i>@TempData["Success"]
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert"></button>
        </div>
    }

    @* ✅ NUEVO: Mostrar Gymbro asignado si el cliente tiene uno *@
    @if (tieneMembresia == true && tieneGymbro)
    {
        <div class="gymbro-card">
            <div class="row align-items-center">
                <div class="col-md-2 text-center">
                    <div class="icon-circle" style="width: 100px; height: 100px; font-size: 3rem; margin: 0;">
                        <i class="fa fa-user-tie"></i>
                    </div>
                </div>
                <div class="col-md-7">
                    <h4 class="text-yellow mb-2">
                        <i class="fa fa-star me-2"></i>Tu Gymbro Asignado
                    </h4>
                    <h5 class="text-white-custom mb-2">@nombreGymbro</h5>
                    <p class="text-muted mb-0">
                        <i class="fa fa-envelope me-2"></i>@emailGymbro
                    </p>
                </div>
                <div class="col-md-3 text-end">
                    <a asp-controller="Rutinas" asp-action="Index" class="btn btn-yellow">
                        <i class="fa fa-dumbbell me-2"></i>Ver Mis Rutinas
                    </a>
                </div>
            </div>
        </div>
    }

    @if (tieneMembresia == true)
    {
        <!-- Tarjetas de acceso rápido -->
        <div class="row">
            <div class="col-md-4 mb-4">
                <div class="feature-card text-center">
                    <div class="icon-circle mx-auto">
                        <i class="fa fa-dumbbell"></i>
                    </div>
                    <h4 class="text-yellow mb-3">Mis Rutinas</h4>
                    <p class="text-white-custom mb-4">Entrena con rutinas personalizadas diseñadas para ti</p>
                    <a asp-controller="Rutinas" asp-action="Index" class="btn btn-yellow">
                        <i class="fa fa-arrow-right me-2"></i>Ver Rutinas
                    </a>
                </div>
            </div>

            <div class="col-md-4 mb-4">
                <div class="feature-card text-center">
                    <div class="icon-circle mx-auto">
                        <i class="fa fa-utensils"></i>
                    </div>
                    <h4 class="text-yellow mb-3">Mi Alimentación</h4>
                    <p class="text-white-custom mb-4">Planes nutricionales adaptados a tus objetivos</p>
                    <a asp-controller="PlanesAlimenticios" asp-action="Index" class="btn btn-yellow">
                        <i class="fa fa-arrow-right me-2"></i>Ver Planes
                    </a>
                </div>
            </div>

            <div class="col-md-4 mb-4">
                <div class="feature-card text-center">
                    <div class="icon-circle mx-auto">
                        <i class="fa fa-shopping-bag"></i>
                    </div>
                    <h4 class="text-yellow mb-3">Tienda</h4>
                    <p class="text-white-custom mb-4">Productos y suplementos de calidad</p>
                    <a asp-controller="Productos" asp-action="Index" class="btn btn-yellow">
                        <i class="fa fa-arrow-right me-2"></i>Ir a Tienda
                    </a>
                </div>
            </div>
        </div>
    }
    else
    {
        <!-- Sección para usuarios SIN membresía -->
        <div class="text-center mb-5">
            <div class="alert alert-custom-warning">
                <h4 class="text-white-custom mb-2">
                    <i class="fa fa-exclamation-triangle me-2"></i>No tienes una membresía activa
                </h4>
                <p class="text-white-custom mb-0">Adquiere una membresía para comenzar tu transformación</p>
            </div>
        </div>

        @if (membresias != null && membresias.Any())
        {
            <!-- Botones para cambiar entre Mensuales y Anuales -->
            <div class="text-center mb-4">
                <div class="btn-group btn-group-lg" role="group">
                    <a asp-action="Index" asp-route-tipo="mensual"
                       class="btn @(tipoMembresia == "mensual" ? "btn-yellow" : "btn-outline-warning") @(tipoMembresia == "mensual" ? "" : "text-white")">
                        <i class="fa fa-calendar me-2"></i>Planes Mensuales
                    </a>
                    <a asp-action="Index" asp-route-tipo="anual"
                       class="btn @(tipoMembresia == "anual" ? "btn-yellow" : "btn-outline-warning") @(tipoMembresia == "anual" ? "" : "text-white")">
                        <i class="fa fa-calendar-check me-2"></i>Planes Anuales
                    </a>
                </div>
            </div>

            <h2 class="text-center text-yellow mb-4">
                <i class="fa fa-star me-2"></i>
                @if (tipoMembresia == "anual")
                {
                    <span>Planes Anuales - ¡Ahorra más!</span>
                }
                else
                {
                    <span>Planes Mensuales</span>
                }
            </h2>

            <div class="row justify-content-center">
                @foreach (var plan in membresias)
                {
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="membership-card">
                            <div class="p-4">
                                <div class="text-center mb-3">
                                    <div class="icon-circle mx-auto" style="width: 60px; height: 60px; font-size: 1.5rem;">
                                        <i class="fa fa-crown"></i>
                                    </div>
                                    <h4 class="text-yellow mb-3">@plan.Nombre</h4>
                                    <h2 class="text-white-custom display-6 mb-0">S/ @plan.Precio.ToString("0.00")</h2>
                                    <p class="text-muted small">
                                        @if (plan.DuracionDias >= 300)
                                        {
                                            <span>@plan.DuracionDias días (1 año)</span>
                                        }
                                        else
                                        {
                                            <span>@plan.DuracionDias días</span>
                                        }
                                    </p>
                                </div>

                                <p class="text-white-custom small mb-3">@plan.Descripcion</p>

                                <h6 class="text-yellow mb-2">Beneficios:</h6>
                                <ul class="list-unstyled small text-white-custom">
                                    @foreach (var beneficio in plan.Beneficios.Take(3))
                                    {
                                        <li class="mb-1">
                                            <i class="fa fa-check-circle text-success me-1"></i>@beneficio
                                        </li>
                                    }
                                </ul>

                                <div class="mb-3">
                                    @if (plan.PermiteRutina)
                                    {
                                        <span class="badge bg-success me-1 mb-2">
                                            <i class="fa fa-dumbbell"></i> Rutinas
                                        </span>
                                    }
                                    @if (plan.PermiteAlimentacion)
                                    {
                                        <span class="badge bg-info mb-2">
                                            <i class="fa fa-utensils"></i> Alimentación
                                        </span>
                                    }
                                </div>

                                <form asp-controller="Membresias" asp-action="IniciarPago" method="post">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="id" value="@plan.MembresiaPlanId" />
                                    <button type="submit" class="btn btn-yellow w-100">
                                        <i class="fa fa-shopping-cart me-2"></i>Adquirir
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <div class="alert alert-custom-warning text-center">
                <i class="fa fa-exclamation-triangle"></i> No hay membresías @tipoMembresia disponibles en este momento.
            </div>
        }

        <!-- Tarjetas informativas para usuarios sin membresía -->
        <div class="row mt-5">
            <div class="col-md-4 mb-4">
                <div class="feature-card text-center">
                    <div class="icon-circle mx-auto">
                        <i class="fa fa-dumbbell"></i>
                    </div>
                    <h4 class="text-yellow mb-3">Entrena Mejor</h4>
                    <p class="text-white-custom">Rutinas personalizadas adaptadas a tus objetivos</p>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="feature-card text-center">
                    <div class="icon-circle mx-auto">
                        <i class="fa fa-utensils"></i>
                    </div>
                    <h4 class="text-yellow mb-3">Come Saludable</h4>
                    <p class="text-white-custom">Planes alimenticios diseñados por profesionales</p>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="feature-card text-center">
                    <div class="icon-circle mx-auto">
                        <i class="fa fa-chart-line"></i>
                    </div>
                    <h4 class="text-yellow mb-3">Progresa Rápido</h4>
                    <p class="text-white-custom">Seguimiento continuo de tu evolución</p>
                </div>
            </div>
        </div>
    }
</div>